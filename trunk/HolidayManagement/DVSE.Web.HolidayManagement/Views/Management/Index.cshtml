@{
    ViewBag.Title = "Index";
}

<h2>User management</h2>

<div id="main">
    <table id="tblEmployees">
        <tr>
            <td></td>
        </tr>
    </table>
    
    <table id="tblRequests">
        <tr>
            <td></td>
        </tr>
    </table>
</div>

<div class="hidden">
    <div id="dialog"></div>
</div>

@section Scripts
{
<script>
    function ManagementModel() {
        var self = this;

        var elements = {
            $tblUsers: null,
            $tblRequests: null,
            $dialog: null
        };

        var initializeElements = function () {
            elements.$tblEmployees = $("#tblEmployees");
            elements.$tblRequests = $("#tblRequests");
            elements.$dialog = $("#dialog");
        };

        var updateEmployee = function (id) {
            $.getJSON("/Management/UpdateEmployee/" + id, function (result) {

                if (result.success == false) {
                    alert(result.message);

                    return;
                }

                elements.$dialog.html(result.content);

                elements.$dialog.dialog({
                    width: 600,
                    title: "Edit employee information",
                    resizable: false,
                    modal: true
                });
            });
        };

        this.instance = null;

        this.initialize = function () {
            initializeElements();

            elements.$tblEmployees.jqGrid({
                url: "/Management/GetEmployees",
                editurl: "/Management/EditEmployee",
                datatype: "json",
                mtype: "GET",
                height: 400,
                colNames: ["First name", "Last name", "Email address", "Team", "Days total", "Days left"],
                colModel: [
                    { name: "FirstName", width: 150, sortable: true },
                    { name: "LastName", width: 150, sortable: true },
                    { name: "EmailAddress", width: 200, sortable: true },
                    { name: "Team", width: 100, sortable: true },
                    { name: "DaysTotal", width: 100, sortable: true },
                    { name: "DaysLeft", width: 100, sortable: true },
                ],
                scroll: true,
                gridComplete: function () {
                    
                }
            });

            $(document).on("dblclick", ".jqgrow", function () {
                var id = elements.$tblEmployees.jqGrid('getGridParam', 'selrow');

                updateEmployee(id);
            });

            $(document).on("click", ".cancel", function () {
                elements.$dialog.dialog("close");
            });
        };

        this.editEmployeeCallback = function (result) {
            var resultJSON = JSON.parse(result.responseText);

            if (resultJSON.success) {
                elements.$dialog.dialog("close");

                elements.$tblEmployees.trigger("reloadGrid");
            }
        };
    }

    ManagementModel.instance = new ManagementModel();

    $(function () {
        ManagementModel.instance.initialize();
    });
</script>
}